<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Highlight & Take Note</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .highlight {
            background-color: yellow;
        }

        .note-highlight {
            background-color: lightgreen;
        }

        .note {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .note-text {
            font-weight: bold;
        }

        .comment-input {
            margin-top: 5px;
            display: block;
            width: 100%;
            padding: 5px;
        }

        .comment-button {
            margin-top: 5px;
        }

        .delete-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            margin-top: 10px;
            cursor: pointer;
            border-radius: 3px;
        }

        .delete-button:hover {
            background-color: #c0392b;
        }

        .comment {
            margin-top: 5px;
            padding-left: 10px;
            font-style: italic;
        }

        #contextMenu {
            position: absolute;
            display: none;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            z-index: 1000;
            width: 150px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        #contextMenu button {
            display: block;
            width: 100%;
            margin-bottom: 5px;
            padding: 5px;
            cursor: pointer;
            text-align: left;
            border: none;
            background: none;
        }

        #contextMenu button:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>

    <h2>Select and right-click any part of this text:</h2>
    <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
        Praesent eget ligula euismod, tempor magna nec, luctus nunc. 
        Donec eget urna vitae risus bibendum ullamcorper. Integer at lorem non nulla cursus lacinia.
    </p>

    <!-- Context Menu -->
    <div id="contextMenu">
        <button onclick="highlightSelectedText()">Highlight</button>
        <button onclick="clearHighlight()">Clear</button>
        <button onclick="clearAllHighlights()">Clear All</button>
        <button onclick="takeNote()">Take Note</button>
    </div>

    <!-- Notes List -->
    <div id="notesList"></div>

    <script>
        let selectedText = null;

        function highlightSelectedText() {
            if (!selectedText) {
                alert("Please select a word or phrase to highlight.");
                return;
            }

            const span = document.createElement("span");
            span.className = "highlight";
            selectedText.surroundContents(span);

            window.getSelection().removeAllRanges();
            hideContextMenu();
        }

        function showContextMenu(event) {
            const selection = window.getSelection();
            if (selection.toString().trim() !== "") {
                event.preventDefault();
                selectedText = selection.getRangeAt(0);

                const contextMenu = document.getElementById("contextMenu");
                contextMenu.style.display = "block";
                contextMenu.style.left = `${event.pageX}px`;
                contextMenu.style.top = `${event.pageY}px`;
            }
        }

        function hideContextMenu() {
            document.getElementById("contextMenu").style.display = "none";
        }

        function clearHighlight() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const span = range.startContainer.parentElement;
                if (span.classList.contains("highlight") || span.classList.contains("note-highlight")) {
                    const text = span.innerText;
                    span.replaceWith(text);
                }
            }
            hideContextMenu();
        }

        function clearAllHighlights() {
            const spans = document.querySelectorAll(".highlight, .note-highlight");
            spans.forEach(span => {
                const text = span.innerText;
                span.replaceWith(text);
            });
            hideContextMenu();
        }

        function takeNote() {
            if (!selectedText) {
                alert("Please select a word or phrase to take a note.");
                return;
            }

            const content = selectedText.toString().trim();
            if (content === "") {
                alert("No text selected to take a note.");
                return;
            }

            // Wrap selected text in green span
            const span = document.createElement("span");
            span.className = "note-highlight";
            selectedText.surroundContents(span);

            const noteElement = document.createElement("div");
            noteElement.className = "note";

            const noteText = document.createElement("div");
            noteText.className = "note-text";
            noteText.textContent = content;
            noteElement.appendChild(noteText);

            const commentInput = document.createElement("input");
            commentInput.type = "text";
            commentInput.className = "comment-input";
            commentInput.placeholder = "Add a comment...";
            noteElement.appendChild(commentInput);

            const commentButton = document.createElement("button");
            commentButton.className = "comment-button";
            commentButton.textContent = "Add Comment";
            commentButton.onclick = function () {
                addComment(noteElement, commentInput.value);
                commentInput.value = "";
            };
            noteElement.appendChild(commentButton);

            const deleteButton = document.createElement("button");
            deleteButton.className = "delete-button";
            deleteButton.textContent = "Delete Note";
            deleteButton.onclick = function () {
                if (confirm("Are you sure you want to delete this note?")) {
                    noteElement.remove();
                }
            };
            noteElement.appendChild(deleteButton);

            const commentsContainer = document.createElement("div");
            commentsContainer.className = "comments";
            noteElement.appendChild(commentsContainer);

            document.getElementById("notesList").appendChild(noteElement);

            window.getSelection().removeAllRanges();
            hideContextMenu();
        }

        function addComment(noteElement, commentText) {
            if (commentText.trim() === "") {
                alert("Please enter a comment.");
                return;
            }

            const commentsContainer = noteElement.querySelector(".comments");

            const commentElement = document.createElement("div");
            commentElement.className = "comment";
            commentElement.textContent = commentText;

            commentsContainer.appendChild(commentElement);
        }

        document.addEventListener("contextmenu", showContextMenu);
        document.addEventListener("click", hideContextMenu);
        document.getElementById("contextMenu").addEventListener("click", e => e.stopPropagation());
    </script>

</body>
</html>
